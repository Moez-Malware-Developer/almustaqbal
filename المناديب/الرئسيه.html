<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تطبيق المندوب - VELO Velocity</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap');
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #f0f2f5;
        }
        .main-button {
            background-color: #EB630A;
            transition: all 0.2s ease;
        }
        .main-button:hover {
            background-color: #d15809;
        }
        .topbar, .navbar {
            background-color: #045482;
            color: white;
        }
        .active-link {
            color: #EB630A;
        }
        .navbar a {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 8px 0;
            transition: color 0.2s ease;
        }
        .navbar a:hover {
            color: #f7a972;
        }
        .card {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 24px;
        }
        .modal {
            background-color: rgba(0, 0, 0, 0.6);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <header class="topbar w-full p-4 shadow-md sticky top-0 z-50">
        <div class="container mx-auto text-center">
            <h1 class="text-2xl font-bold">VELO Velocity</h1>
        </div>
    </header>

    <div class="flex-grow p-4 mb-20">
        <div class="container mx-auto max-w-4xl">
            <h2 class="text-3xl font-bold text-[#045482] mb-6 text-center">طلباتك الحالية</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                <div class="card">
                    <h3 class="text-xl font-semibold mb-4 text-[#EB630A]">في المخزون</h3>
                    <div id="stock-orders" class="space-y-4">
                        <p id="noStockOrders" class="text-center text-gray-500 hidden">لا توجد طلبات جديدة.</p>
                    </div>
                </div>

                <div class="card">
                    <h3 class="text-xl font-semibold mb-4 text-[#045482]">قيد التوصيل</h3>
                    <div id="delivery-orders" class="space-y-4">
                        <p id="noDeliveryOrders" class="text-center text-gray-500 hidden">لا توجد طلبات قيد التوصيل.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <nav class="navbar w-full fixed bottom-0 left-0 right-0 z-50 shadow-lg">
        <div class="container mx-auto flex justify-around items-center h-16">
            <a href="الرئسيه.html" class="active-link">
                <i class="fas fa-home text-2xl"></i>
                <span class="text-xs mt-1">الرئيسية</span>
            </a>
            <a href="./notifications.html">
                <i class="fas fa-bell text-2xl"></i>
                <span class="text-xs mt-1">الإشعارات</span>
            </a>
            <a href="./account.html">
                <i class="fas fa-user-circle text-2xl"></i>
                <span class="text-xs mt-1">الحساب</span>
            </a>
        </div>
    </nav>

    <div id="deliveryModal" class="modal fixed inset-0 flex items-center justify-center hidden">
        <div class="bg-white p-6 rounded-lg shadow-xl w-90 max-w-sm text-right">
            <h3 class="text-lg font-bold mb-4">تفاصيل التسليم</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-gray-700">طريقة الدفع:</label>
                    <div class="mt-1 flex space-x-4 space-x-reverse">
                        <label class="flex items-center">
                            <input type="radio" name="payment-method" value="cash" checked class="form-radio text-[#EB630A]">
                            <span class="mr-2">كاش</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="payment-method" value="card" class="form-radio text-[#EB630A]">
                            <span class="mr-2">بطاقة</span>
                        </label>
                    </div>
                </div>
                <div>
                    <label for="amount" class="block text-gray-700">القيمة المستلمة (د.ل):</label>
                    <input type="number" id="amount" class="w-full mt-1 p-2 border rounded-lg border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#EB630A]" required>
                </div>
            </div>
            <div class="flex justify-between mt-6 space-x-2 space-x-reverse">
                <button id="confirmDeliveryBtn" class="main-button text-white px-4 py-2 rounded-lg">تأكيد التسليم</button>
                <button id="returnOrderBtn" class="bg-yellow-500 text-white px-4 py-2 rounded-lg hover:bg-yellow-600">مرتجع</button>
                <button id="cancelModalBtn" class="bg-gray-400 text-white px-4 py-2 rounded-lg hover:bg-gray-500">إلغاء</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const stockOrdersContainer = document.getElementById('stock-orders');
            const deliveryOrdersContainer = document.getElementById('delivery-orders');
            const deliveryModal = document.getElementById('deliveryModal');
            const amountInput = document.getElementById('amount');
            const confirmDeliveryBtn = document.getElementById('confirmDeliveryBtn');
            const returnOrderBtn = document.getElementById('returnOrderBtn');
            const cancelModalBtn = document.getElementById('cancelModalBtn');
            const noStockOrdersMessage = document.getElementById('noStockOrders');
            const noDeliveryOrdersMessage = document.getElementById('noDeliveryOrders');

            // Hardcoded logged-in delegate.
            const loggedInDelegate = { name: 'فاطمة علي' };
            let currentOrder = null;

            // Load all orders from the main system storage (mimicked here)
            function loadAllOrders() {
                const orders = JSON.parse(localStorage.getItem('adminOrders')) || [
                    { id: 1, code: 'ORD-001', customer: 'علي عبد السلام', phone: '0912345678', region: 'المنطقة الشرقية', city: 'شحات', deliveryFee: 30.00, value: 150.00, totalValue: 180.00, delegate: 'أحمد محمد', status: 'delivered', date: '2025-08-31' },
                    { id: 2, code: 'ORD-002', customer: 'محمد فرج', phone: '0928765432', region: 'المنطقة الشرقية', city: 'البيضاء', deliveryFee: 30.00, value: 230.50, totalValue: 260.50, delegate: 'فاطمة علي', status: 'on-delivery', date: '2025-08-30' },
                    { id: 3, code: 'ORD-003', customer: 'سالمة عبد الله', phone: '0941112233', region: 'المنطقة الوسطى', city: 'مصراتة', deliveryFee: 15.00, value: 75.00, totalValue: 90.00, delegate: 'محمود عبد الله', status: 'in-stock', date: '2025-08-31' },
                    { id: 4, code: 'ORD-004', customer: 'خالد مصطفى', phone: '0915556677', region: 'المنطقة الشرقية', city: 'شحات', deliveryFee: 30.00, value: 300.00, totalValue: 330.00, delegate: 'أحمد محمد', status: 'delivered', date: '2025-08-31' },
                    { id: 5, code: 'ORD-005', customer: 'ليلى سالم', phone: '0929998877', region: 'المنطقة الغربية', city: 'طرابلس', deliveryFee: 10.00, value: 95.00, totalValue: 105.00, delegate: 'أحمد محمد', status: 'in-stock', date: '2025-08-29' }
                ];
                if (!localStorage.getItem('adminOrders')) {
                    localStorage.setItem('adminOrders', JSON.stringify(orders));
                }
                return JSON.parse(localStorage.getItem('adminOrders'));
            }

            function renderOrders() {
                const allOrders = loadAllOrders();
                const delegateOrders = allOrders.filter(order => order.delegate === loggedInDelegate.name);
                
                const stockOrders = delegateOrders.filter(o => o.status === 'in-stock');
                const deliveryOrders = delegateOrders.filter(o => o.status === 'on-delivery');

                stockOrdersContainer.innerHTML = '';
                deliveryOrdersContainer.innerHTML = '';

                if (stockOrders.length === 0) {
                    noStockOrdersMessage.classList.remove('hidden');
                } else {
                    noStockOrdersMessage.classList.add('hidden');
                    stockOrders.forEach(order => {
                        stockOrdersContainer.appendChild(createOrderCard(order, 'receive'));
                    });
                }
                
                if (deliveryOrders.length === 0) {
                    noDeliveryOrdersMessage.classList.remove('hidden');
                } else {
                    noDeliveryOrdersMessage.classList.add('hidden');
                    deliveryOrders.forEach(order => {
                        deliveryOrdersContainer.appendChild(createOrderCard(order, 'deliver'));
                    });
                }
            }

            function createOrderCard(order, actionType) {
                const card = document.createElement('div');
                card.className = 'bg-gray-100 p-4 rounded-lg flex justify-between items-center flex-wrap';
                card.innerHTML = `
                    <div>
                        <p class="font-bold text-lg">${order.customer}</p>
                        <p class="text-sm text-gray-600">طلب #${order.code}</p>
                        <p class="text-sm text-gray-600">القيمة: ${order.totalValue.toFixed(2)} د.ل</p>
                        <p class="text-sm text-gray-600">المدينة: ${order.city}</p>
                        <p class="text-sm text-gray-600">الهاتف: ${order.phone}</p>
                    </div>
                `;
                
                const actionBtn = document.createElement('button');
                actionBtn.className = 'main-button text-white text-sm px-4 py-2 rounded-lg mt-2 md:mt-0';
                
                if (actionType === 'receive') {
                            actionBtn.textContent = 'استلام الطلب';
                            actionBtn.onclick = () => {
                                const confirmReceive = confirm('هل أنت متأكد من استلام هذا الطلب؟');
                                if (confirmReceive) {
                                    updateOrderStatus(order.id, 'on-delivery');
                                }
                            };
                } else if (actionType === 'deliver') {
                    actionBtn.textContent = 'تسليم الطلب';
                    actionBtn.onclick = () => openDeliveryModal(order);
                }
                
                card.appendChild(actionBtn);
                return card;
            }

            function updateOrderStatus(orderId, newStatus) {
                const allOrders = loadAllOrders();
                const orderIndex = allOrders.findIndex(o => o.id === orderId);
                if (orderIndex !== -1) {
                    allOrders[orderIndex].status = newStatus;
                    localStorage.setItem('adminOrders', JSON.stringify(allOrders));
                    alert('تم تحديث حالة الطلب بنجاح.');
                    renderOrders();
                }
            }
            
            function openDeliveryModal(order) {
                currentOrder = order;
                amountInput.value = order.totalValue.toFixed(2);
                deliveryModal.classList.remove('hidden');
            }

            cancelModalBtn.addEventListener('click', () => {
                deliveryModal.classList.add('hidden');
                currentOrder = null;
            });

            confirmDeliveryBtn.addEventListener('click', () => {
                if (!currentOrder) return;
                const paidAmount = parseFloat(amountInput.value) || 0;
                const paymentMethod = document.querySelector('input[name="payment-method"]:checked').value;
                updateOrderStatus(currentOrder.id, 'delivered');
                deliveryModal.classList.add('hidden');
            });
            
            returnOrderBtn.addEventListener('click', () => {
                if (!currentOrder) return;
                updateOrderStatus(currentOrder.id, 'returned');
                deliveryModal.classList.add('hidden');
            });
            
            renderOrders();
        });
    </script>
</body>
</html>